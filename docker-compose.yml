version: "3.3"
services:
    frontend:
        restart: on-failure
        build: ./frontend
        container_name: frontend
        command: npm run dev -- --host
        ports:
            - 3000:3000
            - 24678:24678
        volumes:
            - ./frontend:/app
            - /app/node_modules

    backend:
        restart: always
        build: ./backend
        container_name: backend
        volumes:
            - ./backend:/app
        ports:
            - 2000:2000
        depends_on:
        #    - docu_db
            - rel_db
            - graph_db
        links:
            - rel_db
    # docu_db:
    #     image: mongo

    rel_db:
        image: postgres
        container_name: rel_db
        environment: 
          POSTGRES_PASSWORD: postgres
          POSTGRES_USER: postgres
          POSTGRES_DB: mandatory
        volumes:
            - pgdata:/var/lib/postgresql/data
        ports:
            - 5432:5432

    graph_db:
        image: neo4j
        restart: unless-stopped
        ports:
            - 7474:7474
            - 7687:7687
        container_name: graph_db
        volumes:
            - ./conf:/conf
            - ./data:/data
            - ./import:/import
            - ./logs:/logs
            - ./plugins:/plugins
        environment:
            - NEO4J_AUTH=none
            - NEO4J_dbms_security_auth__enabled=false

volumes:
    pgdata: